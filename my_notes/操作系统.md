# 进程



## 特点

1. 进程之间是独立的，内存空间不共享



## 进程挂起

进程挂起和进程阻塞是不一样的，挂起的进程不占用内存空间，而是被保存到硬盘中

### 挂起状态分类

- 阻塞挂起状态：进程在外存并等待某个事件的出现
- 就绪挂起状态：进程在外存，但只要进入内存，即可运行





# 线程



## 优点

1. 线程之间可以并发执行
2. 线程之间可以共享相同的地址空间
3. 一个进程可以同时存在多个线程

## 缺点

- 一个线程崩溃，会导致其所属的进程中的所有线程崩溃（安全可靠性没有保障）



## 特点

1. 每个线程都要有自己的寄存器，堆栈，才能确保每个线程（控制流）之间是相互独立的。进程是一个完整的资源空间
2. 一个进程中的线程共用一个管理内存空间的页表，线程在切换时，不需要更换页表。切换进程时，要切换页表，开销比较大。
3. 线程之间的数据交换只需要访问地址即可，不需要经过内核





## 线程与进程的选择

强调性能时，我们用线程的方式执行

性能不是瓶颈，考虑安全性的问题，更多采取进程方式执行



## 线程的分类

- 用户线程：操作系统看不到的线程，由专门的用户线程库来完成对线程的管理。

  > 在用户空间实现的线程机制，它不依赖于操作系统的内核，由一组用户级的线程库函数来完成线程的管理，包括线程的创建，中止，同步和调度等

  - 特点
    - 由于用户线程的维护由相应进程来完成（通过线程库函数），不需要操作系统内核了解用户线程的存在，可用于不支持线程操作的多进程操作系统
    - 每个进程都需要它自己私有的线程控制块（TCB）列表，用来跟踪记录它的各个线程的状态信息（PC，栈指针，寄存器），TCB由线程库函数来维护。
    - 用户线程的切换也是由线程库函数来完成，无需用户态/核心态切换，所以速度特别快
    - 允许每个线程都有自己自定义的线程调度算法
  - 缺点
    - 阻塞性的系统调用如何实现？如果一个线程发起系统调用而阻塞，则整个进程在等待（因为操作系统无法看到线程，只能挂起整个进程）
    - 当一个线程开始运行后，除非它主动交出CPU的使用权，否则它所在的进程当中的其他线程将无法运行（用户态的线程库无法主动打断用户线程的执行）
    - 由于时间片分配给进程，故与其他进程相比，在多线程执行时，每个线程得到的时间片较少，执行会较慢

- 内核线程：操作系统管理起来的线程，即操作系统看得到的线程

  > 是指在操作系统的内核当中实现的一种线程机制，由操作系统的内核来完成线程的创建，终止和管理

  - 特点

    - 在支持内核线程的操作系统中，由内核来维护进程和线程的上下文信息（PCB和TCB）
    - 线程的创建，终止和切换都是通过系统调用/内核函数的方式来执行，由内核来完成，因此系统开销较大
    - 在一个进程当中，如果某个内核线程发起系统调用而被阻塞，并不会影响其他内核线程的运行
    - 时间片分配给线程，多线程的进程获得更多CPU时间

    > windows NT和Windows XP\2000支持内核线程

- 轻量级进程

  它是内核支持的用户线程，一个进程可以有一个（Linux）或多个（Solaris）轻量级进程，每个轻量级进程由一个单独的内核线程来支持。



